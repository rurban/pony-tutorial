<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Match - Pony Tutorial</title>
  

  <link rel="shortcut icon" href="../../img/favicon.ico">

  
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700' rel='stylesheet' type='text/css'>

  <link rel="stylesheet" href="../../css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../css/theme_extra.css" type="text/css" />
  <link rel="stylesheet" href="../../css/highlight.css">
  <link href="../../css/highlight.css" rel="stylesheet">

  
  <script>
    // Current page data
    var mkdocs_page_name = "Match";
  </script>
  
  <script src="../../js/jquery-2.1.1.min.js"></script>
  <script src="../../js/modernizr-2.8.3.min.js"></script>
  <script type="text/javascript" src="../../js/highlight.pack.js"></script>
  <script src="../../js/theme.js"></script> 
  <script src="../../js/highlight.pack.js"></script>

  
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
      <div class="wy-side-nav-search">
        <a href="../.." class="icon icon-home"> Pony Tutorial</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
        <ul class="current">
          
            <li>
    <ul class="subnav">
    <li><span>Getting started</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../..">Welcome!</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../getting-started/what-you-need-to-start/">What you need to start</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../getting-started/installation/">Installation</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../getting-started/helloworld/">Helloworld</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../getting-started/how-it-works/">How it works</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../getting-started/whitespace/">Whitespace</a>
        
    </li>

        
    </ul>
<li>
          
            <li>
    <ul class="subnav">
    <li><span>Types</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../types/static-vs-dynamic/">Static vs dynamic</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../types/classes/">Classes</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../types/primitives/">Primitives</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../types/actors/">Actors</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../types/traits-and-interfaces/">Traits and interfaces</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../types/type-aliases/">Type aliases</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../types/type-expressions/">Type expressions</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../types/delegates/">Delegates</a>
        
    </li>

        
    </ul>
<li>
          
            <li>
    <ul class="subnav">
    <li><span>Expressions</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../expressions/variables/">Variables</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../expressions/infix-ops/">Infix ops</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../expressions/control-structures/">Control structures</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../expressions/methods/">Methods</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../expressions/exceptions/">Exceptions</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../expressions/sugar/">Sugar</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../expressions/object-literals/">Object literals</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../expressions/partial-application/">Partial application</a>
        
    </li>

        
    </ul>
<li>
          
            <li>
    <ul class="subnav">
    <li><span>Capabilities</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../capabilities/object-capabilities/">Object capabilities</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../capabilities/reference-capabilities/">Reference capabilities</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../capabilities/guarantees/">Guarantees</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../capabilities/aliasing/">Aliasing</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../capabilities/consume-and-destructive-read/">Consume and destructive read</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../capabilities/recovering-capabilities/">Recovering capabilities</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../capabilities/combining-capabilities/">Combining capabilities</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../capabilities/passing-and-sharing/">Passing and sharing</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../capabilities/capability-subtyping/">Capability subtyping</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../capabilities/arrow-types/">Arrow types</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../capabilities/trust-boundary/">Trust boundary</a>
        
    </li>

        
    </ul>
<li>
          
            <li>
    <ul class="subnav">
    <li><span>Generics</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../generics/polymorphic-types/">Polymorphic types</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../generics/polymorphic-methods/">Polymorphic methods</a>
        
    </li>

        
    </ul>
<li>
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="../../composition-inheritance/code-sharing/">Code sharing</a>
        
    </li>
<li>
          
            <li>
    <ul class="subnav">
    <li><span>Pattern Matching</span></li>

        
            
    <li class="toctree-l1 current">
        <a class="current" href="./">Match</a>
        
            <ul>
            
                <li class="toctree-l3"><a href="#match-expressions">Match expressions</a></li>
                
                    <li><a class="toctree-l4" href="#else-cases">Else cases</a></li>
                
            
                <li class="toctree-l3"><a href="#matching-on-values">Matching on values</a></li>
                
            
                <li class="toctree-l3"><a href="#matching-on-type-and-value">Matching on type and value</a></li>
                
                    <li><a class="toctree-l4" href="#captures">Captures</a></li>
                
            
                <li class="toctree-l3"><a href="#matching-tuples">Matching tuples</a></li>
                
            
                <li class="toctree-l3"><a href="#guards">Guards</a></li>
                
            
            </ul>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../as/">As</a>
        
    </li>

        
    </ul>
<li>
          
            <li>
    <ul class="subnav">
    <li><span>Packages</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../packages/package-system/">Package system</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../packages/use-statement/">Use statement</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../packages/builtin/">Builtin</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../packages/platform/">Use conditions</a>
        
    </li>

        
    </ul>
<li>
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="../../compiler-clargs/clargs/">Compiler args</a>
        
    </li>
<li>
          
            <li>
    <ul class="subnav">
    <li><span>C FFI</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../c-ffi/calling-c/">Calling C</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../c-ffi/linking-c/">Linking to C Libraries</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../c-ffi/c-abi/">C abi</a>
        
    </li>

        
    </ul>
<li>
          
            <li>
    <ul class="subnav">
    <li><span>The Runtime</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../runtime/otp/">Otp</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../runtime/memory-allocation/">Memory allocation</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../runtime/garbage-collection/">Garbage collection</a>
        
    </li>

        
    </ul>
<li>
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="../../examples/examples/">Examples</a>
        
    </li>
<li>
          
        </ul>
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../..">Pony Tutorial</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../..">Docs</a> &raquo;</li>
    
      
        
          <li>Pattern Matching &raquo;</li>
        
      
    
    <li>Match</li>
    <li class="wy-breadcrumbs-aside">
      
    </li>
  </ul>
  <hr/>
</div>
          <div role="main">
            <div class="section">
              
                <p>If we want to compare an expression to a value then we use an <code>if</code>. But if we want to compare an expression to a lot of values this gets very tedious. Pony provides a powerful pattern matching facility, combining matching on values and types, without any special code required.</p>
<h1 id="match-expressions">Match expressions</h1>
<p>Here's a simple example of a match expression that produces a string.</p>
<pre><code class="pony">match x
| 2 =&gt; &quot;int&quot;
| 2.0 =&gt; &quot;float&quot;
| &quot;2&quot; =&gt; &quot;string&quot;
else
  &quot;something else&quot;
end
</code></pre>

<p>If you're used to functional languages this should be very familiar.</p>
<p>For those readers more familiar with the C and Java family of languages, think of this like a switch statement. But you can switch on values other than just integers, like Strings. In fact you can switch on any type that provides a comparison function, including your own classes. And you can also switch on the runtime type of an expression.</p>
<p>A match starts with the keyword <code>match</code>, followed by the expression to match, which is known as the match <strong>operand</strong>. In this example the operand is just the variable <code>x</code>, but it can be any expression.</p>
<p>Most of the match expression consists of a series of <strong>cases</strong> that we match against. Each case consists of a pipe symbol ('|'), the <strong>pattern</strong> to match against, an arrow ('=&gt;') and the expression to evaluate if the case matches.</p>
<p>We go through the cases one by one until we find one that matches. (Actually, in practice the compiler is a lot more intelligent than that and uses a combination of sequential checks and jump tables to be as efficient as possible.)</p>
<p>Note that each match case has an expression to evaluate and these are all independent. There is no "fall through" between cases as there is in languages such as C.</p>
<p>If the value produced by the match expression isn't used then the cases can omit the arrow and expression to evaluate. This can be useful for excluding specific cases before a more general case.</p>
<h2 id="else-cases">Else cases</h2>
<p>As with all Pony control structures the else case for a match expression is used if we have no other value, i.e. if none of our cases match. The else case, if there is one, <strong>must</strong> come at the end of the match, after all of the specific cases.</p>
<p>If the value the match expression results in is used then you need to have an else case, even if it can never actually be reached. If you omit it a default will be added which evaluates to <code>None</code>. The compiler currently isn't clever enough to spot when the other cases are exhaustive and so the else is not needed. This will be changed later.</p>
<h1 id="matching-on-values">Matching on values</h1>
<p>The simplest match expression just matches on value.</p>
<pre><code class="pony">fun f(x: U32): String =&gt;
  match x
  | 1 =&gt; &quot;one&quot;
  | 2 =&gt; &quot;two&quot;
  | 3 =&gt; &quot;three&quot;
  | 5 =&gt; &quot;not four&quot;
  else
    &quot;something else&quot;
  end
</code></pre>

<p>For value matching the pattern is simply the value we want to match to, just like a C switch statement. The case with the same value as the operand wins and we use its expression.</p>
<p>The compiler calls the eq() function on the operand, passing the pattern as the argument. This means that you can use your own types as match operands and patterns, as long as you define an eq() function.</p>
<pre><code class="pony">class Foo
  var _x: U32

  new create(x: U32) =&gt;
    _x = x

  fun eq(that: Foo): Bool =&gt;
    _x == that._x

actor Main
  fun f(x: Foo): String =&gt;
    match x
    | Foo(1) =&gt; &quot;one&quot;
    | Foo(2) =&gt; &quot;two&quot;
    | Foo(3) =&gt; &quot;three&quot;
    | Foo(5) =&gt; &quot;not four&quot;
    else
      &quot;something else&quot;
    end
</code></pre>

<h1 id="matching-on-type-and-value">Matching on type and value</h1>
<p>Matching on value is fine if the match operand and case patterns have all the same type. However match can cope with multiple different types. Each case pattern is first checked to see if it is the same type as the runtime type of the operand. Only then will the values be compared.</p>
<pre><code class="pony">fun f(x: (U32 | String | None)): String =&gt;
  match x
  | None =&gt; &quot;none&quot;
  | 2 =&gt; &quot;two&quot;
  | 3 =&gt; &quot;three&quot;
  | &quot;5&quot; =&gt; &quot;not four&quot;
  else
    &quot;something else&quot;
  end
</code></pre>

<p>In many languages using runtime type information is very expensive and so it is generally avoided whenever possible.</p>
<p>In Pony it's cheap. Really cheap. Pony's "whole program" approach to compilation means the compiler can work out as much as possible at compile time. The runtime cost of each type check is generally a single pointer comparison. Plus of course, any checks which can be fully determined at compile time are. So for up casts there's no runtime cost at all.</p>
<h2 id="captures">Captures</h2>
<p>Sometimes you want to be able to match on type, for any value of that type. For this you use a <strong>capture</strong>. This defines a local variable, valid only within the case, containing the value of the operand. If the operand is not of the specified type then the case doesn't match.</p>
<p>Captures look just like variable declarations within the pattern. Like normal variables they can be declared as var or let. If you're not going to reassign them within the case expression it is good practice to use let.</p>
<pre><code class="pony">fun f(x: (U32 | String | None)): String =&gt;
  match x
  | None =&gt; &quot;none&quot;
  | 2 =&gt; &quot;two&quot;
  | 3 =&gt; &quot;three&quot;
  | let u: U32 =&gt; &quot;other integer&quot;
  | let s: String =&gt; s
  else
    &quot;something else&quot;
  end
</code></pre>

<p><strong>Can I omit the type from a capture, like I can from a local variable?</strong> Unfortunately no. Since we match on type and value the compiler has to know what type the pattern is, so it can't be inferred.</p>
<h1 id="matching-tuples">Matching tuples</h1>
<p>If you want to match on more than one operand at once then you can simply use a tuple. Cases will only match if <strong>all</strong> the tuple elements match.</p>
<pre><code class="pony">fun f(x: (String | None), y: U32): String =&gt;
  match (x, y)
  | (None, let y: U32) =&gt; &quot;none&quot;
  | (let s: String, 2) =&gt; s + &quot; two&quot;
  | (let s: String, 3) =&gt; s + &quot; three&quot;
  | (let s: String, let u: U32) =&gt; s + &quot; other integer&quot;
  else
    &quot;something else&quot;
  end
</code></pre>

<p><strong>Do I have to specify all the elements in a tuple?</strong> No you don't. Any tuple elements in a pattern can be marked as "don't care" by using an underscore ('_'). The first and fourth cases in our example don't actually care about the U32 element, so we can ignore it.</p>
<pre><code class="pony">fun f(x: (String | None), y: U32): String =&gt;
  match (x, y)
  | (None, _) =&gt; &quot;none&quot;
  | (let s: String, 2) =&gt; s + &quot; two&quot;
  | (let s: String, 3) =&gt; s + &quot; three&quot;
  | (let s: String, _) =&gt; s + &quot; other integer&quot;
  else
    &quot;something else&quot;
  end
</code></pre>

<h1 id="guards">Guards</h1>
<p>In addition to matching on types and values each case in a match can also have a guard condition. This is simply an expression, evaluated <strong>after</strong> type and value matching has occurred, that must give the value true for the case to match. If the guard is false then the case doesn't match and we move onto the next in the usual way.</p>
<p>Guards are introduced with the <code>where</code> keyword.</p>
<p>A guard expression may use any captured variables from that case, which allows for handling ranges and complex functions.</p>
<pre><code class="pony">fun f(x: (String | None), y: U32): String =&gt;
  match (x, y)
  | (None, _) =&gt; &quot;none&quot;
  | (let s: String, 2) =&gt; s + &quot; two&quot;
  | (let s: String, 3) =&gt; s + &quot; three&quot;
  | (let s: String, let u: U32) where u &gt; 14 =&gt; s + &quot; other big integer&quot;
  | (let s: String, _) =&gt; s + &quot; other small integer&quot;
  else
    &quot;something else&quot;
  end
</code></pre>
              
            </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../as/" class="btn btn-neutral float-right" title="As"/>Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
        <a href="../../composition-inheritance/code-sharing/" class="btn btn-neutral" title="Code sharing"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
  </div>

  Built with <a href="http://www.mkdocs.org">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
	  
        </div>
      </div>

    </section>

  </div>

<div class="rst-versions" role="note" style="cursor: pointer">
    <span class="rst-current-version" data-toggle="rst-current-version">
      
      
        <span><a href="../../composition-inheritance/code-sharing/" style="color: #fcfcfc;">&laquo; Previous</a></span>
      
      
        <span style="margin-left: 15px"><a href="../as/" style="color: #fcfcfc">Next &raquo;</a></span>
      
    </span>
</div>

</body>
</html>
